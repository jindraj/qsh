#!/bin/bash

QUERY_CUSTOMIZATION=$2

CUSTOMIZED_ORDER_BY=$(echo "$QUERY_CUSTOMIZATION" | grep -q "order by");
if [[ $? -ne 0 ]]; then
  ORDER_BY="order by 2, 3, 5"
fi;

cat <<EOF > $1
select * from (
	select t.TABLE_TYPE, c.TABLE_SCHEMA, c.TABLE_NAME, c.COLUMN_NAME, c.ORDINAL_POSITION, c.COLUMN_DEFAULT, c.IS_NULLABLE, c.DATA_TYPE, c.CHARACTER_MAXIMUM_LENGTH, c.NUMERIC_PRECISION, c.NUMERIC_SCALE
	from INFORMATION_SCHEMA.COLUMNS c
	inner join INFORMATION_SCHEMA.tables t on c.TABLE_CATALOG = t.TABLE_CATALOG and c.TABLE_SCHEMA = t.TABLE_SCHEMA and c.TABLE_NAME = t.TABLE_NAME
  where c.TABLE_CATALOG = db_name()
  and c.TABLE_SCHEMA not in ('INFORMATION_SCHEMA', 'sys', 'guest')
) t
$QUERY_CUSTOMIZATION
$ORDER_BY;
EOF

