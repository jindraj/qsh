#!/bin/bash

PANE_ID=$(tmux display-message -p '#{pane_id}')
QSH_TTY=$(tty)

if [[ -z "$QSH_DISABLE_RESULT_PREPROCESSING" ]]; then
  export QSH_OUTPUT_FINALIZER=$QSH_CLIENTS/sqlcl/qsh-output-finalizer;
fi;

QSH_CLIENT_PANE=$QSH_TMP/client.${PANE_ID}
QSH_EXECUTE_QUERY=$QSH_TMP/execute.${PANE_ID}.sql
QSH_PAGER_COMMAND=$QSH_SCRIPTS/qsh-pager;

[[ -z "$QSH_SQLCL_MAX_RESULT_SIZE" ]] && QSH_SQLCL_MAX_RESULT_SIZE=1000000;
INVOCATION="$INVOCATION @$QSH_CLIENTS/sqlcl/connect.sql";

eval "QSH_INVOCATION=\"$INVOCATION\" QSH_SQL_CLIENT=sqlcl QSH_CLIENT_PANE=$QSH_CLIENT_PANE QSH_EXECUTE_QUERY=$QSH_EXECUTE_QUERY SQLPATH=$QSH_CLIENTS/sqlcl/lib QSH_PAGER_COMMAND=$QSH_PAGER_COMMAND QSH_SQLCL_MAX_RESULT_SIZE=$QSH_SQLCL_MAX_RESULT_SIZE QSH_TTY=$QSH_TTY $CLIENT $INVOCATION";

