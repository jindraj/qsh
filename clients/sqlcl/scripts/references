#!/bin/bash

QUERY_CUSTOMIZATION=$2

cat <<EOF > $1
select * from (
  select a.OWNER as REFERENCING_TABLE_SCHEMA, a.TABLE_NAME as REFERENCING_TABLE_NAME,
         a.CONSTRAINT_NAME as REFERENCING_CONSTRAINT_NAME,
         a.R_OWNER as REFERENCED_TABLE_SCHEMA, ra.TABLE_NAME as REFERENCED_TABLE_NAME,
         a.R_CONSTRAINT_NAME as REFERENCED_CONSTRAINT_NAME
  from USER_CONSTRAINTS a 
  inner join USER_CONSTRAINTS ra on a.R_OWNER = ra.OWNER and a.R_CONSTRAINT_NAME = ra.CONSTRAINT_NAME
  where a.CONSTRAINT_TYPE = 'R'
  order by 1, 2, 3
) t
$QUERY_CUSTOMIZATION;
EOF

